#
# Copyright (c) rPath, Inc.
#

class GroupRpathPlatform(GroupRecipe):
    name = 'group-rpath-platform'
    version = '7'

    # group-rpath-platform is a trove bucket, not an image group, so disable
    # most checks.  See below for the actual image group definitions.
    imageGroup = False
    depCheck = False
    autoResolve = False
    checkPathConflicts = False

    packages = """
# Contrib - centos-6n
amiconfig
cluster-glue
corosync
crmsh
drbd
ec2-ami-tools
gunicorn
info-haclient
info-hacluster
info-jabber
info-nagios
info-nginx
info-pgbouncer
jabberd
kernel-drbd
libevent
libgsasl
librsync
mercurial
mod_python
nagios-plugins
nginx
nrpe
pacemaker
pgbouncer
puppet-corosync
puppet-stdlib
python-alembic
python-argparse
python-beaker
python-chameleon
python-crypto
python-epdb
python-formencode
python-mako
python-ordereddict
python-paste-deploy
python-paste-filesystem
python-psycopg2
python-pyramid
python-pyramid_beaker
python-pyramid_simpleform
python-pyramid_tm
python-repoze-filesystem
python-repoze-lru
python-setproctitle
python-transaction
python-translationstring
python-twisted
python-txpostgres
python-unittest2
python-venusian
python-webhelpers
python-webob
python-webunit
python-zope-deprecation
python-zope-filesystem
python-zope-interface
python-zope-sqlalchemy
rdiff-backup
resource-agents
rubygem-hiera
rubygem-json_pure
SQLAlchemy
udns

# Contrib - rpl-2-py26
boto
django=contrib.rpath.org@rpath:centos-6n/1.3.5-2-1
django-cache-memcached=contrib.rpath.org@rpath:centos-6n/1.3.5-2-1
django-db-postgres=contrib.rpath.org@rpath:centos-6n/1.3.5-2-1
django-rest-interface=contrib.rpath.org@rpl:2-py26/r81-5-0.1
django-debug-toolbar=contrib.rpath.org@rpl:2-py26
glance-client
markdown
paramiko
python-cssutils
python-dateutil
python-httplib2
python-keyutils
python-memcached
python-novaclient
python-pam
python-wokkel
python-xattr
pywbem
PyYAML
vobject
XenAPI

# rPL 2 - rpl-2-py26
decorator
dnspython
elementtree
epdb
kid
mx
python-sqlite

# non-python contrib packages
MochiKit
yui

# Postgres
info-postgres=postgres.rb.rpath.com@rpath:postgres-9.2-devel
postgresql92=postgres.rb.rpath.com@rpath:postgres-9.2-devel
python-pgsql=postgres.rb.rpath.com@rpath:postgres-9.2-devel

# Miscellaneous
conary-web-common=conary.rpath.com@rpl:1
info-apache=conary.rpath.com@rpl:2
info-rmake=conary.rpath.com@rpl:2
info-rmake-chroot=conary.rpath.com@rpl:2
rapa-plugin-rPath=conary.rpath.com@rpl:2
bitstream-vera-fonts=conary.rpath.com@rpl:2
group-rpm=rpm.rpath.org@rpath:centos-6-devel
"""

    def setup(r):
        r.setGroupSearchPath()
        #r.addAll('group-os', flatten=True)

        for pkg, versionStr in r.packageManifest:
            r.add(pkg, versionStr)

    def setGroupSearchPath(r):
        r.setSearchPath(
            'contrib.rpath.org@rpath:centos-6n',
            'contrib.rpath.org@rpl:2-py26',
            'conary.rpath.com@rpl:2-py26',
            'contrib.rpath.org@rpl:2',
            'conary.rpath.com@rpl:2',
        )

    @property
    def packageManifest(r):
        for pkg in r.packages.split('\n'):
            pkg = pkg.strip()
            if not pkg or pkg.startswith('#'):
                continue
            arr = pkg.split('=', 1)
            if len(arr) == 1:
                yield pkg, None
                continue
            yield arr[0], arr[1]
